<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Aprendo a Leer - Audio y T√°ctil</title>
    <style>
        /* ============================================
           RESET TOTAL - T√ÅCTIL OPTIMIZADO
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent !important;
            -webkit-touch-callout: none !important;
            -webkit-user-select: none !important;
            user-select: none !important;
            touch-action: manipulation !important;
            font-family: Arial, Helvetica, sans-serif !important;
            font-style: normal !important;
        }

        body {
            background: linear-gradient(145deg, #1B4F6E, #2C8F8F);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 40px;
            padding: 20px;
            border: 5px solid #FFB347;
        }

        /* ============================================
           PERSONAJE
           ============================================ */
        .header-juego {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            background: linear-gradient(145deg, #2C8F8F, #1B4F6E);
            padding: 20px;
            border-radius: 50px;
            border: 4px solid white;
        }

        .personaje {
            width: 120px;
            height: 120px;
            background: #FFB347;
            border-radius: 60px 60px 30px 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 5px solid white;
        }

        .mensaje-personaje {
            flex: 1;
            background: white;
            padding: 20px;
            border-radius: 40px;
            font-size: 2em;
            color: #1B4F6E;
            font-weight: bold;
            border: 4px solid #FFB347;
            min-height: 100px;
            display: flex;
            align-items: center;
        }

        /* ============================================
           SELECTOR DE LETRAS
           ============================================ */
        .selector-letras {
            background: #E8F0F5;
            border-radius: 40px;
            padding: 20px;
            margin-bottom: 20px;
            border: 4px solid #1B4F6E;
        }

        .letras-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .letra-boton {
            width: 85px;
            height: 85px;
            background: #2C8F8F;
            color: white;
            font-size: 3.2em;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 30px;
            border: 4px solid white;
            border-bottom: 8px solid #1B4F6E;
            opacity: 0.5;
        }

        .letra-boton.activa {
            opacity: 1;
            background: #FFB347;
            border-bottom-color: #C96F0F;
        }

        .letra-boton.desbloqueada {
            opacity: 0.8;
        }

        /* ============================================
           NIVELES
           ============================================ */
        .niveles-container {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            background: #E8F0F5;
            padding: 15px;
            border-radius: 50px;
            border: 4px solid #1B4F6E;
        }

        .nivel {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 40px;
            opacity: 0.6;
            min-width: 120px;
        }

        .nivel.activo {
            opacity: 1;
            background: #2C8F8F;
            border: 4px solid white;
        }

        .nivel-icono {
            font-size: 2.8em;
        }

        .nivel-texto {
            font-size: 1.5em;
            font-weight: bold;
            color: #1B4F6E;
        }

        .nivel.activo .nivel-texto {
            color: white;
        }

        /* ============================================
           RECOMPENSAS
           ============================================ */
        .recompensas {
            background: linear-gradient(145deg, #2C8F8F, #1B4F6E);
            padding: 15px;
            border-radius: 40px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
            border: 4px solid #FFB347;
        }

        .monedas {
            background: #FFB347;
            padding: 12px 25px;
            border-radius: 40px;
            font-size: 2em;
            font-weight: bold;
            color: #1B4F6E;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 4px solid white;
        }

        .stickers {
            display: flex;
            gap: 12px;
        }

        .sticker {
            font-size: 2.5em;
            background: white;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 4px solid #FFB347;
            opacity: 0.3;
        }

        .sticker.desbloqueado {
            opacity: 1;
        }

        /* ============================================
           GRID DE JUEGOS
           ============================================ */
        .juegos-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .juego-tarjeta {
            background: white;
            border-radius: 30px;
            padding: 15px;
            border: 5px solid #2C8F8F;
        }

        .juego-titulo {
            background: #1B4F6E;
            color: white;
            padding: 12px 20px;
            border-radius: 40px;
            display: inline-block;
            font-size: 1.8em;
            margin-bottom: 15px;
            border: 4px solid #FFB347;
            font-weight: bold;
        }

        /* ============================================
           S√çLABAS - UN SOLO TOQUE
           ============================================ */
        .silabas-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .silaba-boton {
            background: #2C8F8F;
            color: white;
            font-size: 2.5em;
            font-weight: bold;
            padding: 18px 0;
            text-align: center;
            border-radius: 30px;
            border: 5px solid white;
            border-bottom: 8px solid #1B4F6E;
        }

        /* ============================================
           PALABRAS
           ============================================ */
        .palabras-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
        }

        .palabra-juego {
            background: #F5F9FF;
            border-radius: 25px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 4px solid #2C8F8F;
        }

        .imagen-palabra {
            width: 70px;
            height: 70px;
            background: #FFB347;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.8em;
            border: 4px solid white;
        }

        .texto-palabra {
            font-size: 2em;
            font-weight: bold;
            color: #1B4F6E;
        }

        /* ============================================
           JUEGO DE FORMAR - UN SOLO TOQUE
           ============================================ */
        .juego-arrastrar {
            background: #E8F0F5;
            border-radius: 30px;
            padding: 15px;
        }

        .palabra-objetivo {
            font-size: 3.2em;
            text-align: center;
            color: #1B4F6E;
            margin-bottom: 15px;
            background: #FFB347;
            padding: 15px;
            border-radius: 45px;
            border: 5px solid white;
            font-weight: bold;
        }

        .silabas-arrastrables {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .silaba-arrastrable {
            background: #2C8F8F;
            color: white;
            font-size: 2.5em;
            font-weight: bold;
            padding: 18px;
            text-align: center;
            border-radius: 25px;
            border: 5px solid white;
            border-bottom: 8px solid #1B4F6E;
        }

        .zona-soltar {
            background: white;
            border: 6px dashed #2C8F8F;
            border-radius: 35px;
            padding: 25px;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 2.2em;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .silaba-seleccionada {
            background: #2C8F8F;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1.8em;
            border: 3px solid white;
        }

        /* ============================================
           BOTONES DE ACCI√ìN
           ============================================ */
        .botones-accion {
            display: flex;
            gap: 8px;
            margin: 12px 0;
        }

        .boton-accion {
            background: #FF6B6B;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 35px;
            font-size: 1.6em;
            font-weight: bold;
            border-bottom: 6px solid #C44545;
            flex: 1;
            text-align: center;
        }

        .boton-grande {
            background: #2C8F8F;
            color: white;
            border: none;
            padding: 18px;
            border-radius: 40px;
            font-size: 2em;
            font-weight: bold;
            width: 100%;
            border-bottom: 8px solid #1B4F6E;
            margin: 8px 0;
            text-align: center;
        }

        .boton-grande.verificar {
            background: #FFB347;
            border-bottom-color: #C96F0F;
            color: #1B4F6E;
        }

        /* ============================================
           ACENTOS
           ============================================ */
        .acentos-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin: 15px 0;
        }

        .boton-acento {
            background: #1B4F6E;
            color: white;
            font-size: 2.2em;
            font-weight: bold;
            padding: 12px 5px;
            text-align: center;
            border-radius: 30px;
            border: 4px solid white;
            border-bottom: 6px solid #0A2A3A;
        }

        /* ============================================
           ESCRITURA
           ============================================ */
        .escritura-area {
            text-align: center;
        }

        .imagen-escritura {
            font-size: 6em;
            background: #FFB347;
            width: 160px;
            height: 160px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            border: 6px solid #2C8F8F;
        }

        .input-escritura {
            width: 100%;
            padding: 18px;
            font-size: 2.5em;
            text-align: center;
            border: 5px solid #2C8F8F;
            border-radius: 35px;
            margin-bottom: 15px;
        }

        .miniaturas-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin: 15px 0;
        }

        .miniatura {
            background: #E8F0F5;
            border-radius: 20px;
            padding: 10px;
            text-align: center;
            border: 4px solid #2C8F8F;
        }

        .miniatura-imagen {
            font-size: 2.5em;
        }

        .miniatura-texto {
            font-size: 1.4em;
            font-weight: bold;
            color: #1B4F6E;
        }

        /* ============================================
           MENSAJES
           ============================================ */
        .mensaje-juego {
            background: #FFB347;
            padding: 12px;
            border-radius: 30px;
            font-size: 1.6em;
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
            border: 4px solid white;
            color: #1B4F6E;
        }

        .mensaje-exito {
            background: #2C8F8F;
            color: white;
            padding: 12px;
            border-radius: 30px;
            font-size: 1.6em;
            text-align: center;
            margin: 10px 0;
            border: 4px solid #FFB347;
        }

        .footer {
            text-align: center;
            margin-top: 20px;
            font-size: 1.6em;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- PERSONAJE -->
        <div class="header-juego">
            <div class="personaje">
                <div class="personaje-ojos">
                    <div class="ojo"></div>
                    <div class="ojo"></div>
                </div>
                <div class="boca"></div>
                <div style="color: white; font-size: 1.5em;">ABC</div>
            </div>
            <div class="mensaje-personaje" id="mensajePersonaje">
                ¬°Hola! Elige una letra
            </div>
        </div>

        <!-- SELECTOR DE LETRAS -->
        <div class="selector-letras">
            <div class="letras-grid" id="selectorLetras">
                <div class="letra-boton activa" data-letra="M" ontouchstart="seleccionarLetra('M')">M</div>
                <div class="letra-boton" data-letra="P" ontouchstart="seleccionarLetra('P')">P</div>
                <div class="letra-boton" data-letra="L" ontouchstart="seleccionarLetra('L')">L</div>
                <div class="letra-boton" data-letra="S" ontouchstart="seleccionarLetra('S')">S</div>
                <div class="letra-boton" data-letra="T" ontouchstart="seleccionarLetra('T')">T</div>
                <div class="letra-boton" data-letra="N" ontouchstart="seleccionarLetra('N')">N</div>
                <div class="letra-boton" data-letra="D" ontouchstart="seleccionarLetra('D')">D</div>
                <div class="letra-boton" data-letra="C" ontouchstart="seleccionarLetra('C')">C</div>
                <div class="letra-boton" data-letra="R" ontouchstart="seleccionarLetra('R')">R</div>
                <div class="letra-boton" data-letra="B" ontouchstart="seleccionarLetra('B')">B</div>
            </div>
        </div>

        <!-- NIVELES -->
        <div class="niveles-container">
            <div class="nivel activo" data-nivel="1" ontouchstart="cambiarNivel(1)">
                <span class="nivel-icono">ü•ö</span>
                <span class="nivel-texto">Nivel 1</span>
            </div>
            <div class="nivel" data-nivel="2" ontouchstart="cambiarNivel(2)">
                <span class="nivel-icono">üê£</span>
                <span class="nivel-texto">Nivel 2</span>
            </div>
            <div class="nivel" data-nivel="3" ontouchstart="cambiarNivel(3)">
                <span class="nivel-icono">ü¶ú</span>
                <span class="nivel-texto">Nivel 3</span>
            </div>
        </div>

        <!-- RECOMPENSAS -->
        <div class="recompensas">
            <div class="monedas">
                <span>ü™ô</span>
                <span id="contadorMonedas">5</span>
            </div>
            <div class="stickers" id="stickersContainer">
                <span class="sticker">üêí</span>
                <span class="sticker">üöÄ</span>
                <span class="sticker">‚öΩ</span>
                <span class="sticker">ü¶Å</span>
                <span class="sticker">üêâ</span>
            </div>
        </div>

        <!-- JUEGOS -->
        <div class="juegos-grid">
            <!-- JUEGO 1: S√çLABAS -->
            <div class="juego-tarjeta">
                <div class="juego-titulo">üîä S√≠labas</div>
                <div class="silabas-grid" id="silabasGrid"></div>
                <div class="mensaje-juego" id="mensajeSilabas">Toca una s√≠laba</div>
            </div>

            <!-- JUEGO 2: PALABRAS -->
            <div class="juego-tarjeta">
                <div class="juego-titulo">üìñ Palabras</div>
                <div class="palabras-grid" id="palabrasJuego"></div>
            </div>

            <!-- JUEGO 3: FORMAR -->
            <div class="juego-tarjeta">
                <div class="juego-titulo">üß© Formar</div>
                <div class="juego-arrastrar">
                    <div class="palabra-objetivo" id="palabraObjetivo">Mama</div>
                    
                    <div class="silabas-arrastrables" id="silabasArrastrables"></div>
                    
                    <div class="zona-soltar" id="zonaSoltar">
                        üëÜ Toca las s√≠labas
                    </div>
                    
                    <div class="acentos-container">
                        <div class="boton-acento" ontouchstart="agregarAcento('√Å')">√Å</div>
                        <div class="boton-acento" ontouchstart="agregarAcento('√â')">√â</div>
                        <div class="boton-acento" ontouchstart="agregarAcento('√ç')">√ç</div>
                        <div class="boton-acento" ontouchstart="agregarAcento('√ì')">√ì</div>
                        <div class="boton-acento" ontouchstart="agregarAcento('√ö')">√ö</div>
                    </div>
                    
                    <div class="botones-accion">
                        <div class="boton-accion" ontouchstart="limpiarZonaFormar()">üßπ Limpiar</div>
                        <div class="boton-accion" ontouchstart="reiniciarJuegoFormar()">üîÑ Nueva</div>
                    </div>
                    
                    <div class="boton-grande verificar" ontouchstart="verificarPalabraFormada()">‚úÖ Verificar</div>
                    
                    <div id="resultadoFormar" class="mensaje-juego"></div>
                </div>
            </div>

            <!-- JUEGO 4: ESCRIBIR -->
            <div class="juego-tarjeta">
                <div class="juego-titulo">‚úèÔ∏è Escribir</div>
                <div class="escritura-area">
                    <div class="imagen-escritura" id="imagenEscritura" ontouchstart="cambiarPalabraEscrituraAleatoria()">üë©</div>
                    
                    <input type="text" class="input-escritura" id="inputEscritura" 
                           placeholder="Escribe" maxlength="6">
                    
                    <div class="acentos-container">
                        <div class="boton-acento" ontouchstart="agregarAcentoEscritura('√Å')">√Å</div>
                        <div class="boton-acento" ontouchstart="agregarAcentoEscritura('√â')">√â</div>
                        <div class="boton-acento" ontouchstart="agregarAcentoEscritura('√ç')">√ç</div>
                        <div class="boton-acento" ontouchstart="agregarAcentoEscritura('√ì')">√ì</div>
                        <div class="boton-acento" ontouchstart="agregarAcentoEscritura('√ö')">√ö</div>
                    </div>
                    
                    <div class="miniaturas-grid" id="miniaturasEscritura"></div>
                    
                    <div class="botones-accion">
                        <div class="boton-accion" ontouchstart="limpiarInputEscritura()">üßπ Limpiar</div>
                        <div class="boton-accion" ontouchstart="reiniciarEscritura()">üîÑ Nueva</div>
                    </div>
                    
                    <div class="boton-grande" ontouchstart="verificarEscritura()">üîç Revisar</div>
                    
                    <div id="resultadoEscritura" class="mensaje-juego"></div>
                </div>
            </div>
        </div>

        <div class="footer">‚≠ê M P L S T N D C R B ‚≠ê</div>
    </div>

    <script>
        // ============================================
        // AUDIO CON GOOGLE TRANSLATE (FUNCIONA SIEMPRE)
        // ============================================
        function hablar(texto) {
            try {
                // Crear audio con Google Translate (FUNCIONA EN TODOS LADOS)
                const audio = new Audio();
                audio.src = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodeURIComponent(texto)}&tl=es&client=tw-ob`;
                audio.play().catch(e => console.log('Error audio:', e));
            } catch(e) {
                console.log('Error al reproducir:', e);
            }
        }

        // ============================================
        // DATOS DE PALABRAS
        // ============================================
        const palabrasPorLetra = {
            'M': {
                1: [
                    { palabra: 'Mama', imagen: 'üë©' },
                    { palabra: 'Memo', imagen: 'üìù' },
                    { palabra: 'Mimi', imagen: 'üê±' },
                    { palabra: 'Momo', imagen: 'üçë' },
                    { palabra: 'Mumu', imagen: 'üêÑ' }
                ],
                2: [
                    { palabra: 'Mam√°', imagen: 'üë©‚Äçüëß' },
                    { palabra: 'Mem√°', imagen: 'üíù' },
                    { palabra: 'Mim√°', imagen: 'üíï' }
                ],
                3: [
                    { palabra: 'Mapa', imagen: 'üó∫Ô∏è' },
                    { palabra: 'Puma', imagen: 'üêÜ' },
                    { palabra: 'Loma', imagen: '‚õ∞Ô∏è' }
                ]
            },
            'P': {
                1: [
                    { palabra: 'Papa', imagen: 'ü•î' },
                    { palabra: 'Pepe', imagen: 'üë®' },
                    { palabra: 'Pipa', imagen: 'üö¨' }
                ],
                2: [
                    { palabra: 'Pap√°', imagen: 'üë®‚Äçüëß' }
                ],
                3: [
                    { palabra: 'Mapa', imagen: 'üó∫Ô∏è' },
                    { palabra: 'Puma', imagen: 'üêÜ' },
                    { palabra: 'Pala', imagen: 'üõ†Ô∏è' }
                ]
            },
            'L': {
                1: [
                    { palabra: 'Lala', imagen: 'üéµ' },
                    { palabra: 'Lelo', imagen: 'üòµ' },
                    { palabra: 'Lili', imagen: 'üå∏' }
                ],
                2: [
                    { palabra: 'Lul√∫', imagen: 'üê©' }
                ],
                3: [
                    { palabra: 'Loma', imagen: '‚õ∞Ô∏è' },
                    { palabra: 'Pala', imagen: 'üõ†Ô∏è' },
                    { palabra: 'Sala', imagen: 'üè†' }
                ]
            },
            'S': {
                1: [
                    { palabra: 'Sasa', imagen: 'üëß' },
                    { palabra: 'Sese', imagen: 'üó£Ô∏è' },
                    { palabra: 'Sisi', imagen: '‚úÖ' }
                ],
                2: [
                    { palabra: 'Sus√∫', imagen: 'ü§´' }
                ],
                3: [
                    { palabra: 'Sima', imagen: 'üèûÔ∏è' },
                    { palabra: 'Paso', imagen: 'üë£' },
                    { palabra: 'Sopa', imagen: 'üç≤' }
                ]
            }
        };

        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        let letraActual = 'M';
        let nivelActual = 1;
        let letrasDesbloqueadas = ['M'];
        let monedas = 5;
        let silabasSeleccionadas = [];
        let palabraActualEscribir = 'Mama';

        // ============================================
        // FUNCIONES PRINCIPALES
        // ============================================
        function seleccionarLetra(letra) {
            if (!letrasDesbloqueadas.includes(letra)) {
                if (monedas >= 5) {
                    monedas -= 5;
                    document.getElementById('contadorMonedas').innerHTML = monedas;
                    letrasDesbloqueadas.push(letra);
                } else {
                    document.getElementById('mensajePersonaje').innerHTML = `Faltan monedas para ${letra}`;
                    return;
                }
            }
            
            letraActual = letra;
            actualizarSelectorLetras();
            cargarTodo();
            hablar(`Letra ${letra}`);
        }

        function actualizarSelectorLetras() {
            document.querySelectorAll('.letra-boton').forEach(btn => {
                let letra = btn.getAttribute('data-letra');
                btn.classList.remove('activa', 'desbloqueada');
                if (letra === letraActual) btn.classList.add('activa');
                if (letrasDesbloqueadas.includes(letra)) btn.classList.add('desbloqueada');
            });
        }

        function cambiarNivel(nivel) {
            nivelActual = nivel;
            document.querySelectorAll('.nivel').forEach(n => n.classList.remove('activo'));
            document.querySelector(`[data-nivel="${nivel}"]`).classList.add('activo');
            cargarTodo();
            hablar(`Nivel ${nivel}`);
        }

        function cargarTodo() {
            cargarSilabas();
            cargarPalabras();
            cargarMiniaturasEscritura();
            reiniciarJuegoFormar();
        }

        function cargarSilabas() {
            let html = '';
            ['ma','me','mi','mo','mu'].forEach(s => {
                html += `<div class="silaba-boton" ontouchstart="aprenderSilaba('${s}')">${s}</div>`;
            });
            document.getElementById('silabasGrid').innerHTML = html;
        }

        function cargarPalabras() {
            let palabras = palabrasPorLetra[letraActual]?.[nivelActual] || [];
            let html = '';
            palabras.forEach(p => {
                html += `
                    <div class="palabra-juego" ontouchstart="seleccionarPalabra('${p.palabra}')">
                        <div class="imagen-palabra">${p.imagen}</div>
                        <div>
                            <div class="texto-palabra">${p.palabra}</div>
                        </div>
                    </div>
                `;
            });
            document.getElementById('palabrasJuego').innerHTML = html;
        }

        function cargarMiniaturasEscritura() {
            let palabras = palabrasPorLetra[letraActual]?.[nivelActual] || [];
            let html = '';
            palabras.forEach(p => {
                html += `
                    <div class="miniatura" ontouchstart="cambiarPalabraEscritura('${p.palabra}', '${p.imagen}')">
                        <div class="miniatura-imagen">${p.imagen}</div>
                        <div class="miniatura-texto">${p.palabra}</div>
                    </div>
                `;
            });
            document.getElementById('miniaturasEscritura').innerHTML = html;
        }

        function aprenderSilaba(silaba) {
            hablar(silaba);
            document.getElementById('mensajeSilabas').innerHTML = `üîä ${silaba}`;
        }

        function seleccionarPalabra(palabra) {
            hablar(palabra);
            document.getElementById('mensajePersonaje').innerHTML = palabra;
        }

        function reiniciarJuegoFormar() {
            let palabras = palabrasPorLetra[letraActual]?.[nivelActual] || [];
            if (palabras.length === 0) return;
            
            let palabra = palabras[Math.floor(Math.random() * palabras.length)];
            document.getElementById('palabraObjetivo').innerHTML = palabra.palabra;
            
            // Crear s√≠labas a partir de la palabra
            let silabas = [];
            for (let i = 0; i < palabra.palabra.length; i += 2) {
                if (i + 1 <= palabra.palabra.length) {
                    silabas.push(palabra.palabra.substring(i, i + 2).toLowerCase());
                }
            }
            
            // A√±adir s√≠labas extra
            while (silabas.length < 4) {
                let extras = ['ma','me','mi','mo','mu'];
                silabas.push(extras[Math.floor(Math.random() * extras.length)]);
            }
            
            // Mezclar
            silabas.sort(() => Math.random() - 0.5);
            
            let html = '';
            silabas.forEach(s => {
                html += `<div class="silaba-arrastrable" ontouchstart="seleccionarSilaba('${s}')">${s}</div>`;
            });
            document.getElementById('silabasArrastrables').innerHTML = html;
            
            document.getElementById('zonaSoltar').innerHTML = 'üëÜ Toca las s√≠labas';
            silabasSeleccionadas = [];
            document.getElementById('resultadoFormar').innerHTML = '';
        }

        function seleccionarSilaba(silaba) {
            let palabraObjetivo = document.getElementById('palabraObjetivo').innerHTML;
            let numSilabas = Math.ceil(palabraObjetivo.length / 2);
            
            if (silabasSeleccionadas.length < numSilabas) {
                silabasSeleccionadas.push(silaba);
                let zona = document.getElementById('zonaSoltar');
                if (zona.innerHTML === 'üëÜ Toca las s√≠labas') zona.innerHTML = '';
                
                let span = document.createElement('span');
                span.className = 'silaba-seleccionada';
                span.innerHTML = silaba;
                zona.appendChild(span);
            }
        }

        function agregarAcento(vocal) {
            if (silabasSeleccionadas.length > 0) {
                let ultima = silabasSeleccionadas[silabasSeleccionadas.length - 1];
                let vocales = ['a','e','i','o','u'];
                
                for (let i = ultima.length - 1; i >= 0; i--) {
                    if (vocales.includes(ultima[i].toLowerCase())) {
                        ultima = ultima.substring(0, i) + vocal + ultima.substring(i + 1);
                        silabasSeleccionadas[silabasSeleccionadas.length - 1] = ultima;
                        break;
                    }
                }
                actualizarZonaSoltar();
            }
        }

        function actualizarZonaSoltar() {
            let zona = document.getElementById('zonaSoltar');
            zona.innerHTML = '';
            silabasSeleccionadas.forEach(s => {
                let span = document.createElement('span');
                span.className = 'silaba-seleccionada';
                span.innerHTML = s;
                zona.appendChild(span);
            });
        }

        function limpiarZonaFormar() {
            document.getElementById('zonaSoltar').innerHTML = 'üëÜ Toca las s√≠labas';
            silabasSeleccionadas = [];
            document.getElementById('resultadoFormar').innerHTML = '';
        }

        function verificarPalabraFormada() {
            let palabraObjetivo = document.getElementById('palabraObjetivo').innerHTML;
            let palabraFormada = silabasSeleccionadas.join('');
            
            if (palabraFormada.toLowerCase() === palabraObjetivo.toLowerCase()) {
                document.getElementById('resultadoFormar').innerHTML = 'üéâ ¬°Bien! +2 monedas';
                hablar('¬°Muy bien!');
                monedas += 2;
                document.getElementById('contadorMonedas').innerHTML = monedas;
                setTimeout(reiniciarJuegoFormar, 1500);
            } else {
                document.getElementById('resultadoFormar').innerHTML = 'ü§î Intenta otra vez';
                hablar('Casi');
            }
        }

        function cambiarPalabraEscritura(palabra, imagen) {
            palabraActualEscribir = palabra;
            document.getElementById('imagenEscritura').innerHTML = imagen;
            document.getElementById('inputEscritura').value = '';
            document.getElementById('resultadoEscritura').innerHTML = '';
            hablar(palabra);
        }

        function cambiarPalabraEscrituraAleatoria() {
            let palabras = palabrasPorLetra[letraActual]?.[nivelActual] || [];
            if (palabras.length > 0) {
                let p = palabras[Math.floor(Math.random() * palabras.length)];
                cambiarPalabraEscritura(p.palabra, p.imagen);
            }
        }

        function agregarAcentoEscritura(vocal) {
            let input = document.getElementById('inputEscritura');
            let pos = input.selectionStart;
            input.value = input.value.substring(0, pos) + vocal + input.value.substring(pos);
            input.setSelectionRange(pos + 1, pos + 1);
            input.focus();
        }

        function limpiarInputEscritura() {
            document.getElementById('inputEscritura').value = '';
            document.getElementById('resultadoEscritura').innerHTML = '';
        }

        function reiniciarEscritura() {
            cambiarPalabraEscrituraAleatoria();
            limpiarInputEscritura();
        }

        function normalizarTexto(t) {
            return t.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
        }

        function verificarEscritura() {
            let escrito = document.getElementById('inputEscritura').value.trim();
            
            if (escrito === palabraActualEscribir) {
                document.getElementById('resultadoEscritura').innerHTML = '‚≠ê ¬°Perfecto! +3 monedas';
                hablar('¬°Excelente!');
                monedas += 3;
                document.getElementById('contadorMonedas').innerHTML = monedas;
            } else if (normalizarTexto(escrito) === normalizarTexto(palabraActualEscribir)) {
                document.getElementById('resultadoEscritura').innerHTML = 'üëç Revisa la tilde';
                hablar('Revisa la tilde');
            } else {
                document.getElementById('resultadoEscritura').innerHTML = '‚úèÔ∏è Sigue practicando';
                hablar('Intenta de nuevo');
            }
        }

        // ============================================
        // INICIALIZAR
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            cargarTodo();
            document.getElementById('contadorMonedas').innerHTML = monedas;
        });
    </script>
</body>
</html>
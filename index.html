<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Aprendo a Leer - Todas las Letras</title>
    <style>
        /* ============================================
           ESTILOS GENERALES
           ============================================ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Segoe UI', 'Comic Sans MS', 'Chalkboard SE', cursive, sans-serif;
        }

        body {
            background: linear-gradient(145deg, #1B4F6E, #2C8F8F);
            min-height: 100vh;
            padding: 12px;
            touch-action: manipulation;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.96);
            border-radius: 40px;
            padding: 20px;
            box-shadow: 0 20px 40px rgba(0, 20, 30, 0.4);
            border: 5px solid #FFB347;
        }

        .header-juego {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
            background: linear-gradient(145deg, #2C8F8F, #1B4F6E);
            padding: 20px;
            border-radius: 50px;
            border: 4px solid white;
        }

        .personaje {
            width: 120px;
            height: 120px;
            background: #FFB347;
            border-radius: 60px 60px 30px 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 5px solid white;
            box-shadow: 0 8px 0 #C96F0F;
        }

        .personaje-ojos {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
        }

        .ojo {
            width: 25px;
            height: 25px;
            background: white;
            border-radius: 50%;
        }

        .boca {
            width: 40px;
            height: 15px;
            background: white;
            border-radius: 0 0 20px 20px;
        }

        .mensaje-personaje {
            flex: 1;
            background: white;
            padding: 20px 30px;
            border-radius: 40px;
            font-size: 2em;
            color: #1B4F6E;
            font-weight: bold;
            border: 4px solid #FFB347;
            box-shadow: 0 5px 0 #C96F0F;
            min-height: 100px;
            display: flex;
            align-items: center;
        }

        .selector-letras {
            background: #E8F0F5;
            border-radius: 40px;
            padding: 20px;
            margin-bottom: 20px;
            border: 4px solid #1B4F6E;
        }

        .selector-titulo {
            font-size: 2em;
            color: #1B4F6E;
            margin-bottom: 15px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .letras-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
        }

        .letra-boton {
            width: 90px;
            height: 90px;
            background: #2C8F8F;
            color: white;
            font-size: 3.5em;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 30px;
            border: 4px solid white;
            border-bottom: 8px solid #1B4F6E;
            cursor: pointer;
            transition: all 0.2s;
            opacity: 0.5;
        }

        .letra-boton.activa {
            opacity: 1;
            background: #FFB347;
            border-bottom-color: #C96F0F;
            transform: scale(1.05);
            box-shadow: 0 0 20px #FFB347;
        }

        .letra-boton.desbloqueada {
            opacity: 0.8;
        }

        .letra-boton:active {
            transform: translateY(4px);
            border-bottom-width: 4px;
        }

        .niveles-container {
            display: flex;
            justify-content: space-around;
            margin-bottom: 25px;
            background: #E8F0F5;
            padding: 20px;
            border-radius: 50px;
            border: 4px solid #1B4F6E;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nivel {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 15px 25px;
            border-radius: 40px;
            transition: all 0.3s;
            opacity: 0.6;
            min-width: 130px;
        }

        .nivel.activo {
            opacity: 1;
            background: #2C8F8F;
            transform: scale(1.05);
            border: 4px solid white;
            box-shadow: 0 5px 0 #1B4F6E;
        }

        .nivel-icono {
            font-size: 3em;
        }

        .nivel-texto {
            font-size: 1.6em;
            font-weight: bold;
            color: #1B4F6E;
        }

        .nivel.activo .nivel-texto {
            color: white;
        }

        .recompensas {
            background: linear-gradient(145deg, #2C8F8F, #1B4F6E);
            padding: 20px;
            border-radius: 40px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 30px;
            border: 4px solid #FFB347;
            flex-wrap: wrap;
        }

        .monedas {
            background: #FFB347;
            padding: 15px 30px;
            border-radius: 40px;
            font-size: 2.2em;
            font-weight: bold;
            color: #1B4F6E;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 4px solid white;
            min-width: 150px;
            justify-content: center;
        }

        .stickers {
            flex: 1;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .sticker {
            font-size: 2.8em;
            background: white;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 4px solid #FFB347;
            opacity: 0.3;
            transition: all 0.3s;
        }

        .sticker.desbloqueado {
            opacity: 1;
            transform: scale(1.1);
            border-color: #2C8F8F;
            background: #E8F0F5;
        }

        .juegos-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .juego-tarjeta {
            background: white;
            border-radius: 35px;
            padding: 20px;
            border: 5px solid #2C8F8F;
            box-shadow: 0 10px 0 #1B4F6E;
        }

        .juego-titulo {
            background: #1B4F6E;
            color: white;
            padding: 15px 25px;
            border-radius: 40px;
            display: inline-block;
            font-size: 2em;
            margin-bottom: 20px;
            border: 4px solid #FFB347;
            font-weight: bold;
        }

        /* ============================================
           BOTONES DE REINICIO (NUEVOS)
           ============================================ */
        .botones-accion {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .boton-reinicio {
            background: #FF6B6B;
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 40px;
            font-size: 1.8em;
            font-weight: bold;
            border-bottom: 6px solid #C44545;
            cursor: pointer;
            touch-action: manipulation;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex: 1;
        }

        .boton-reinicio:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }

        .boton-reinicio-pequeno {
            background: #FFB347;
            color: #1B4F6E;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 1.4em;
            font-weight: bold;
            border-bottom: 4px solid #C96F0F;
            cursor: pointer;
            touch-action: manipulation;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-left: 10px;
        }

        .boton-reinicio-pequeno:active {
            transform: translateY(3px);
            border-bottom-width: 2px;
        }

        .silabas-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .silaba-boton {
            background: #2C8F8F;
            color: white;
            font-size: 2.8em;
            font-weight: bold;
            padding: 20px 0;
            text-align: center;
            border-radius: 35px;
            border: 5px solid white;
            border-bottom: 8px solid #1B4F6E;
            cursor: pointer;
            transition: all 0.1s;
            touch-action: manipulation;
        }

        .silaba-boton:active {
            transform: translateY(4px);
            border-bottom-width: 4px;
        }

        .silaba-boton.desactivada {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }

        .palabras-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            max-height: 450px;
            overflow-y: auto;
            padding: 8px;
        }

        .palabra-juego {
            background: linear-gradient(145deg, #F5F9FF, #E8F0F5);
            border-radius: 28px;
            padding: 18px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 4px solid #2C8F8F;
            cursor: pointer;
            transition: all 0.2s;
        }

        .palabra-juego:active {
            transform: scale(0.98);
            background: #FFEAA7;
            border-color: #FFB347;
        }

        .imagen-palabra {
            width: 80px;
            height: 80px;
            background: #FFB347;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
            border: 4px solid white;
        }

        .texto-palabra {
            font-size: 2.2em;
            font-weight: bold;
            color: #1B4F6E;
        }

        .texto-palabra-con-acento {
            font-size: 2.2em;
            font-weight: bold;
            color: #FFB347;
            text-decoration: underline wavy #2C8F8F;
        }

        .silabas-mini {
            display: flex;
            gap: 5px;
            margin-top: 5px;
            flex-wrap: wrap;
        }

        .silaba-mini {
            background: #2C8F8F;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 1.2em;
            font-weight: bold;
            border: 2px solid white;
        }

        .silaba-mini-acento {
            background: #FFB347;
            color: #1B4F6E;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 1.2em;
            font-weight: bold;
            border: 2px solid white;
        }

        .juego-arrastrar {
            background: #E8F0F5;
            border-radius: 35px;
            padding: 20px;
        }

        .palabra-objetivo {
            font-size: 3.5em;
            text-align: center;
            color: #1B4F6E;
            margin-bottom: 20px;
            background: #FFB347;
            padding: 20px;
            border-radius: 50px;
            border: 5px solid white;
            font-weight: bold;
            word-break: break-word;
        }

        .silabas-arrastrables {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 20px 0;
        }

        .silaba-arrastrable {
            background: #2C8F8F;
            color: white;
            font-size: 2.8em;
            font-weight: bold;
            padding: 20px;
            text-align: center;
            border-radius: 30px;
            border: 5px solid white;
            border-bottom: 8px solid #1B4F6E;
            cursor: pointer;
            touch-action: manipulation;
        }

        .silaba-arrastrable.acento {
            background: #FFB347;
            border-bottom-color: #C96F0F;
        }

        .zona-soltar {
            background: white;
            border: 6px dashed #2C8F8F;
            border-radius: 40px;
            padding: 30px;
            min-height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 2.5em;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .acentos-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .boton-acento {
            background: #1B4F6E;
            color: white;
            font-size: 2.5em;
            font-weight: bold;
            padding: 15px 5px;
            text-align: center;
            border-radius: 35px;
            border: 4px solid white;
            border-bottom: 6px solid #0A2A3A;
            cursor: pointer;
            touch-action: manipulation;
        }

        .boton-acento:active {
            transform: translateY(3px);
            border-bottom-width: 3px;
        }

        .boton-grande {
            background: #2C8F8F;
            color: white;
            border: none;
            padding: 20px;
            border-radius: 45px;
            font-size: 2.2em;
            font-weight: bold;
            width: 100%;
            border-bottom: 8px solid #1B4F6E;
            cursor: pointer;
            touch-action: manipulation;
            margin: 8px 0;
        }

        .boton-grande:active {
            transform: translateY(4px);
            border-bottom-width: 4px;
        }

        .boton-grande.verificar {
            background: #FFB347;
            border-bottom-color: #C96F0F;
            color: #1B4F6E;
        }

        .escritura-area {
            text-align: center;
        }

        .imagen-escritura {
            font-size: 7em;
            background: #FFB347;
            width: 180px;
            height: 180px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            border: 6px solid #2C8F8F;
            cursor: pointer;
        }

        .input-escritura {
            width: 100%;
            padding: 20px;
            font-size: 2.8em;
            text-align: center;
            border: 5px solid #2C8F8F;
            border-radius: 40px;
            margin-bottom: 20px;
            background: #F5F9FF;
        }

        .miniaturas-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .miniatura {
            background: #E8F0F5;
            border-radius: 25px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border: 4px solid #2C8F8F;
            transition: all 0.2s;
        }

        .miniatura:active {
            transform: scale(0.95);
            background: #FFB347;
        }

        .miniatura-imagen {
            font-size: 2.8em;
        }

        .miniatura-texto {
            font-size: 1.6em;
            font-weight: bold;
            color: #1B4F6E;
            margin-top: 5px;
        }

        .mensaje-juego {
            background: #FFB347;
            padding: 15px;
            border-radius: 35px;
            font-size: 1.8em;
            text-align: center;
            margin: 12px 0;
            font-weight: bold;
            border: 4px solid white;
            color: #1B4F6E;
        }

        .mensaje-exito {
            background: #2C8F8F;
            color: white;
            padding: 15px;
            border-radius: 35px;
            font-size: 1.8em;
            text-align: center;
            margin: 12px 0;
            font-weight: bold;
            border: 4px solid #FFB347;
        }

        .footer {
            text-align: center;
            margin-top: 25px;
            font-size: 1.8em;
            color: white;
            text-shadow: 2px 2px 0 #1B4F6E;
            font-weight: bold;
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #E8F0F5;
            border-radius: 20px;
        }

        ::-webkit-scrollbar-thumb {
            background: #2C8F8F;
            border-radius: 20px;
            border: 2px solid white;
        }

        @media (max-width: 900px) {
            .juegos-grid {
                grid-template-columns: 1fr;
            }
            
            .header-juego {
                flex-direction: column;
                text-align: center;
            }
            
            .mensaje-personaje {
                font-size: 1.6em;
                min-height: 80px;
            }
            
            .letra-boton {
                width: 70px;
                height: 70px;
                font-size: 2.8em;
            }
            
            .silabas-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- PERSONAJE -->
        <div class="header-juego">
            <div class="personaje">
                <div class="personaje-ojos">
                    <div class="ojo"></div>
                    <div class="ojo"></div>
                </div>
                <div class="boca"></div>
                <div style="color: white; font-size: 1.6em; margin-top: 10px;">ABC</div>
            </div>
            <div class="mensaje-personaje" id="mensajePersonaje">
                ¬°Hola! Elige una letra para aprender
            </div>
        </div>

        <!-- SELECTOR DE LETRAS -->
        <div class="selector-letras">
            <div class="selector-titulo">
                <span>üî§</span> ¬øQu√© letra quieres aprender?
            </div>
            <div class="letras-grid" id="selectorLetras">
                <div class="letra-boton activa" data-letra="M" onclick="seleccionarLetra('M')">M</div>
                <div class="letra-boton" data-letra="P" onclick="seleccionarLetra('P')">P</div>
                <div class="letra-boton" data-letra="L" onclick="seleccionarLetra('L')">L</div>
                <div class="letra-boton" data-letra="S" onclick="seleccionarLetra('S')">S</div>
                <div class="letra-boton" data-letra="T" onclick="seleccionarLetra('T')">T</div>
                <div class="letra-boton" data-letra="N" onclick="seleccionarLetra('N')">N</div>
                <div class="letra-boton" data-letra="D" onclick="seleccionarLetra('D')">D</div>
                <div class="letra-boton" data-letra="C" onclick="seleccionarLetra('C')">C</div>
                <div class="letra-boton" data-letra="R" onclick="seleccionarLetra('R')">R</div>
                <div class="letra-boton" data-letra="B" onclick="seleccionarLetra('B')">B</div>
            </div>
            <p style="text-align: center; margin-top: 15px; font-size: 1.4em; color: #1B4F6E;">
                ‚≠ê Comienza con M, gana monedas y desbloquea las dem√°s ‚≠ê
            </p>
        </div>

        <!-- SISTEMA DE NIVELES -->
        <div class="niveles-container" id="nivelesContainer">
            <div class="nivel activo" data-nivel="1" onclick="cambiarNivel(1)">
                <span class="nivel-icono">ü•ö</span>
                <span class="nivel-texto">Nivel 1</span>
            </div>
            <div class="nivel" data-nivel="2" onclick="cambiarNivel(2)">
                <span class="nivel-icono">üê£</span>
                <span class="nivel-texto">Nivel 2</span>
            </div>
            <div class="nivel" data-nivel="3" onclick="cambiarNivel(3)">
                <span class="nivel-icono">ü¶ú</span>
                <span class="nivel-texto">Nivel 3</span>
            </div>
        </div>

        <!-- RECOMPENSAS -->
        <div class="recompensas">
            <div class="monedas">
                <span>ü™ô</span>
                <span id="contadorMonedas">5</span>
            </div>
            <div class="stickers" id="stickersContainer">
                <span class="sticker" data-sticker="1">üêí</span>
                <span class="sticker" data-sticker="2">üöÄ</span>
                <span class="sticker" data-sticker="3">‚öΩ</span>
                <span class="sticker" data-sticker="4">ü¶Å</span>
                <span class="sticker" data-sticker="5">üêâ</span>
            </div>
        </div>

        <!-- JUEGOS PRINCIPALES -->
        <div class="juegos-grid">
            <!-- JUEGO 1: APRENDER S√çLABAS -->
            <div class="juego-tarjeta">
                <div class="juego-titulo">
                    üîä 1. S√≠labas
                    <span class="boton-reinicio-pequeno" onclick="reiniciarSilabas()">
                        üîÑ Reiniciar
                    </span>
                </div>
                <div class="silabas-grid" id="silabasGrid">
                    <!-- Se llena con JS -->
                </div>
                <div class="mensaje-juego" id="mensajeSilabas">
                    Elige una letra para ver sus s√≠labas
                </div>
            </div>

            <!-- JUEGO 2: PALABRAS -->
            <div class="juego-tarjeta">
                <div class="juego-titulo">
                    üìñ 2. Palabras
                    <span class="boton-reinicio-pequeno" onclick="reiniciarPalabras()">
                        üîÑ Reiniciar
                    </span>
                </div>
                <div class="palabras-grid" id="palabrasJuego">
                    <!-- Se llena con JS -->
                </div>
            </div>

            <!-- JUEGO 3: FORMAR PALABRAS -->
            <div class="juego-tarjeta">
                <div class="juego-titulo">
                    üß© 3. Formar
                    <span class="boton-reinicio-pequeno" onclick="reiniciarJuegoFormar()">
                        üîÑ Reiniciar
                    </span>
                </div>
                <div class="juego-arrastrar">
                    <div class="palabra-objetivo" id="palabraObjetivo">Mam√°</div>
                    
                    <div class="silabas-arrastrables" id="silabasArrastrables">
                        <!-- Se llena con JS -->
                    </div>
                    
                    <div class="zona-soltar" id="zonaSoltar" onclick="agregarSilabaTactil(event)">
                        üëÜ Toca las s√≠labas
                    </div>
                    
                    <div class="acentos-container">
                        <div class="boton-acento" onclick="agregarAcento('√Å')">√Å</div>
                        <div class="boton-acento" onclick="agregarAcento('√â')">√â</div>
                        <div class="boton-acento" onclick="agregarAcento('√ç')">√ç</div>
                        <div class="boton-acento" onclick="agregarAcento('√ì')">√ì</div>
                        <div class="boton-acento" onclick="agregarAcento('√ö')">√ö</div>
                    </div>
                    
                    <div class="botones-accion">
                        <button class="boton-reinicio" onclick="limpiarZonaFormar()">
                            üßπ Limpiar
                        </button>
                        <button class="boton-reinicio" onclick="reiniciarJuegoFormar()">
                            üîÑ Nueva palabra
                        </button>
                    </div>
                    
                    <button class="boton-grande verificar" onclick="verificarPalabraFormada()">
                        ‚úÖ Verificar
                    </button>
                    
                    <div id="resultadoFormar" class="mensaje-juego"></div>
                </div>
            </div>

            <!-- JUEGO 4: ESCRIBIR -->
            <div class="juego-tarjeta">
                <div class="juego-titulo">
                    ‚úèÔ∏è 4. Escribir
                    <span class="boton-reinicio-pequeno" onclick="reiniciarEscritura()">
                        üîÑ Reiniciar
                    </span>
                </div>
                <div class="escritura-area">
                    <div class="imagen-escritura" id="imagenEscritura" onclick="cambiarPalabraEscrituraAleatoria()">
                        üë©
                    </div>
                    
                    <input type="text" class="input-escritura" id="inputEscritura" 
                           placeholder="Escribe" maxlength="6" inputmode="text" autocomplete="off">
                    
                    <div class="acentos-container">
                        <div class="boton-acento" onclick="agregarAcentoEscritura('√Å')">√Å</div>
                        <div class="boton-acento" onclick="agregarAcentoEscritura('√â')">√â</div>
                        <div class="boton-acento" onclick="agregarAcentoEscritura('√ç')">√ç</div>
                        <div class="boton-acento" onclick="agregarAcentoEscritura('√ì')">√ì</div>
                        <div class="boton-acento" onclick="agregarAcentoEscritura('√ö')">√ö</div>
                    </div>
                    
                    <div class="miniaturas-grid" id="miniaturasEscritura">
                        <!-- Se llena con JS -->
                    </div>
                    
                    <div class="botones-accion">
                        <button class="boton-reinicio" onclick="limpiarInputEscritura()">
                            üßπ Limpiar
                        </button>
                        <button class="boton-reinicio" onclick="reiniciarEscritura()">
                            üîÑ Nueva palabra
                        </button>
                    </div>
                    
                    <button class="boton-grande" onclick="verificarEscritura()">
                        üîç Revisar
                    </button>
                    
                    <div id="resultadoEscritura" class="mensaje-juego"></div>
                </div>
            </div>
        </div>

        <div class="footer">
            ‚≠ê M - P - L - S - T - N - D - C - R - B ‚≠ê
        </div>
    </div>

    <script>
        // ============================================
        // BASE DE DATOS DE PALABRAS POR LETRA Y NIVEL
        // ============================================
        const palabrasPorLetra = {
            'M': {
                1: [
                    { palabra: 'Mama', imagen: 'üë©', silabas: ['Ma', 'ma'], tieneAcento: false },
                    { palabra: 'Memo', imagen: 'üìù', silabas: ['Me', 'mo'], tieneAcento: false },
                    { palabra: 'Mimi', imagen: 'üê±', silabas: ['Mi', 'mi'], tieneAcento: false },
                    { palabra: 'Momo', imagen: 'üçë', silabas: ['Mo', 'mo'], tieneAcento: false },
                    { palabra: 'Mumu', imagen: 'üêÑ', silabas: ['Mu', 'mu'], tieneAcento: false }
                ],
                2: [
                    { palabra: 'Mam√°', imagen: 'üë©‚Äçüëß', silabas: ['Ma', 'm√°'], tieneAcento: true, acentoEn: 1 },
                    { palabra: 'Mem√°', imagen: 'üíù', silabas: ['Me', 'm√°'], tieneAcento: true, acentoEn: 1 },
                    { palabra: 'Mim√°', imagen: 'üíï', silabas: ['Mi', 'm√°'], tieneAcento: true, acentoEn: 1 },
                    { palabra: 'Mam√≥', imagen: 'üëµ', silabas: ['Ma', 'm√≥'], tieneAcento: true, acentoEn: 1 }
                ],
                3: [
                    { palabra: 'Mapa', imagen: 'üó∫Ô∏è', silabas: ['Ma', 'pa'], tieneAcento: false },
                    { palabra: 'Puma', imagen: 'üêÜ', silabas: ['Pu', 'ma'], tieneAcento: false },
                    { palabra: 'Loma', imagen: '‚õ∞Ô∏è', silabas: ['Lo', 'ma'], tieneAcento: false },
                    { palabra: 'Sima', imagen: 'üèûÔ∏è', silabas: ['Si', 'ma'], tieneAcento: false },
                    { palabra: 'Toma', imagen: 'üì∏', silabas: ['To', 'ma'], tieneAcento: false }
                ]
            },
            'P': {
                1: [
                    { palabra: 'Papa', imagen: 'ü•î', silabas: ['Pa', 'pa'], tieneAcento: false },
                    { palabra: 'Pepe', imagen: 'üë®', silabas: ['Pe', 'pe'], tieneAcento: false },
                    { palabra: 'Pipa', imagen: 'üö¨', silabas: ['Pi', 'pa'], tieneAcento: false },
                    { palabra: 'Pipo', imagen: 'üéÆ', silabas: ['Pi', 'po'], tieneAcento: false },
                    { palabra: 'Popo', imagen: 'üí©', silabas: ['Po', 'po'], tieneAcento: false }
                ],
                2: [
                    { palabra: 'Pap√°', imagen: 'üë®‚Äçüëß', silabas: ['Pa', 'p√°'], tieneAcento: true, acentoEn: 1 },
                    { palabra: 'Pip√°', imagen: 'üéØ', silabas: ['Pi', 'p√°'], tieneAcento: true, acentoEn: 1 },
                    { palabra: 'Pop√≥', imagen: 'üöó', silabas: ['Po', 'p√≥'], tieneAcento: true, acentoEn: 1 }
                ],
                3: [
                    { palabra: 'Mapa', imagen: 'üó∫Ô∏è', silabas: ['Ma', 'pa'], tieneAcento: false },
                    { palabra: 'Puma', imagen: 'üêÜ', silabas: ['Pu', 'ma'], tieneAcento: false },
                    { palabra: 'Pala', imagen: 'üõ†Ô∏è', silabas: ['Pa', 'la'], tieneAcento: false },
                    { palabra: 'Paso', imagen: 'üë£', silabas: ['Pa', 'so'], tieneAcento: false },
                    { palabra: 'Pato', imagen: 'ü¶Ü', silabas: ['Pa', 'to'], tieneAcento: false }
                ]
            },
            'L': {
                1: [
                    { palabra: 'Lala', imagen: 'üéµ', silabas: ['La', 'la'], tieneAcento: false },
                    { palabra: 'Lelo', imagen: 'üòµ', silabas: ['Le', 'lo'], tieneAcento: false },
                    { palabra: 'Lili', imagen: 'üå∏', silabas: ['Li', 'li'], tieneAcento: false },
                    { palabra: 'Lolo', imagen: 'üß∏', silabas: ['Lo', 'lo'], tieneAcento: false },
                    { palabra: 'Lulu', imagen: 'üê∂', silabas: ['Lu', 'lu'], tieneAcento: false }
                ],
                2: [
                    { palabra: 'Lul√∫', imagen: 'üê©', silabas: ['Lu', 'l√∫'], tieneAcento: true, acentoEn: 1 },
                    { palabra: 'Lal√°', imagen: 'üé§', silabas: ['La', 'l√°'], tieneAcento: true, acentoEn: 1 }
                ],
                3: [
                    { palabra: 'Loma', imagen: '‚õ∞Ô∏è', silabas: ['Lo', 'ma'], tieneAcento: false },
                    { palabra: 'Pala', imagen: 'üõ†Ô∏è', silabas: ['Pa', 'la'], tieneAcento: false },
                    { palabra: 'Sala', imagen: 'üè†', silabas: ['Sa', 'la'], tieneAcento: false },
                    { palabra: 'Tela', imagen: 'üßµ', silabas: ['Te', 'la'], tieneAcento: false }
                ]
            },
            'S': {
                1: [
                    { palabra: 'Sasa', imagen: 'üëß', silabas: ['Sa', 'sa'], tieneAcento: false },
                    { palabra: 'Sese', imagen: 'üó£Ô∏è', silabas: ['Se', 'se'], tieneAcento: false },
                    { palabra: 'Sisi', imagen: '‚úÖ', silabas: ['Si', 'si'], tieneAcento: false },
                    { palabra: 'Soso', imagen: 'üòê', silabas: ['So', 'so'], tieneAcento: false },
                    { palabra: 'Susi', imagen: 'üê≠', silabas: ['Su', 'si'], tieneAcento: false }
                ],
                2: [
                    { palabra: 'Sus√∫', imagen: 'ü§´', silabas: ['Su', 's√∫'], tieneAcento: true, acentoEn: 1 }
                ],
                3: [
                    { palabra: 'Sima', imagen: 'üèûÔ∏è', silabas: ['Si', 'ma'], tieneAcento: false },
                    { palabra: 'Paso', imagen: 'üë£', silabas: ['Pa', 'so'], tieneAcento: false },
                    { palabra: 'Sala', imagen: 'üè†', silabas: ['Sa', 'la'], tieneAcento: false },
                    { palabra: 'Sopa', imagen: 'üç≤', silabas: ['So', 'pa'], tieneAcento: false }
                ]
            },
            'T': {
                1: [
                    { palabra: 'Tata', imagen: 'üë¥', silabas: ['Ta', 'ta'], tieneAcento: false },
                    { palabra: 'Tete', imagen: 'üë∂', silabas: ['Te', 'te'], tieneAcento: false },
                    { palabra: 'Tito', imagen: 'üêï', silabas: ['Ti', 'to'], tieneAcento: false },
                    { palabra: 'Toto', imagen: 'üöΩ', silabas: ['To', 'to'], tieneAcento: false },
                    { palabra: 'Tutu', imagen: 'üöÇ', silabas: ['Tu', 'tu'], tieneAcento: false }
                ],
                2: [
                    { palabra: 'Tat√°', imagen: 'üëµ', silabas: ['Ta', 't√°'], tieneAcento: true, acentoEn: 1 }
                ],
                3: [
                    { palabra: 'Toma', imagen: 'üì∏', silabas: ['To', 'ma'], tieneAcento: false },
                    { palabra: 'Pato', imagen: 'ü¶Ü', silabas: ['Pa', 'to'], tieneAcento: false },
                    { palabra: 'Tela', imagen: 'üßµ', silabas: ['Te', 'la'], tieneAcento: false },
                    { palabra: 'Tapa', imagen: 'üìï', silabas: ['Ta', 'pa'], tieneAcento: false }
                ]
            },
            'N': {
                1: [
                    { palabra: 'Nana', imagen: 'üëµ', silabas: ['Na', 'na'], tieneAcento: false },
                    { palabra: 'Nene', imagen: 'üë∂', silabas: ['Ne', 'ne'], tieneAcento: false },
                    { palabra: 'Nini', imagen: 'ü§∑', silabas: ['Ni', 'ni'], tieneAcento: false },
                    { palabra: 'Nono', imagen: 'üë¥', silabas: ['No', 'no'], tieneAcento: false },
                    { palabra: 'Nunu', imagen: 'ü™Ü', silabas: ['Nu', 'nu'], tieneAcento: false }
                ],
                2: [
                    { palabra: 'Nan√°', imagen: 'üçº', silabas: ['Na', 'n√°'], tieneAcento: true, acentoEn: 1 }
                ],
                3: [
                    { palabra: 'Nada', imagen: 'üåä', silabas: ['Na', 'da'], tieneAcento: false },
                    { palabra: 'Pana', imagen: 'üß£', silabas: ['Pa', 'na'], tieneAcento: false },
                    { palabra: 'Luna', imagen: 'üåô', silabas: ['Lu', 'na'], tieneAcento: false },
                    { palabra: 'Sana', imagen: 'üè•', silabas: ['Sa', 'na'], tieneAcento: false }
                ]
            },
            'D': {
                1: [
                    { palabra: 'Dada', imagen: 'üé®', silabas: ['Da', 'da'], tieneAcento: false },
                    { palabra: 'Dedo', imagen: 'üëÜ', silabas: ['De', 'do'], tieneAcento: false },
                    { palabra: 'Didi', imagen: 'üéµ', silabas: ['Di', 'di'], tieneAcento: false },
                    { palabra: 'Dodo', imagen: 'ü¶§', silabas: ['Do', 'do'], tieneAcento: false },
                    { palabra: 'Dudu', imagen: 'üöó', silabas: ['Du', 'du'], tieneAcento: false }
                ],
                2: [
                    { palabra: 'Dad√°', imagen: 'üé≠', silabas: ['Da', 'd√°'], tieneAcento: true, acentoEn: 1 }
                ],
                3: [
                    { palabra: 'Nada', imagen: 'üåä', silabas: ['Na', 'da'], tieneAcento: false },
                    { palabra: 'Dama', imagen: 'üë∏', silabas: ['Da', 'ma'], tieneAcento: false },
                    { palabra: 'Dedo', imagen: 'üëÜ', silabas: ['De', 'do'], tieneAcento: false },
                    { palabra: 'D√≠a', imagen: '‚òÄÔ∏è', silabas: ['D√≠', 'a'], tieneAcento: true, acentoEn: 0 }
                ]
            },
            'C': {
                1: [
                    { palabra: 'Caca', imagen: 'üí©', silabas: ['Ca', 'ca'], tieneAcento: false },
                    { palabra: 'Coco', imagen: 'ü••', silabas: ['Co', 'co'], tieneAcento: false },
                    { palabra: 'Cucu', imagen: 'üïäÔ∏è', silabas: ['Cu', 'cu'], tieneAcento: false }
                ],
                2: [
                    { palabra: 'Cac√°', imagen: '‚ö†Ô∏è', silabas: ['Ca', 'c√°'], tieneAcento: true, acentoEn: 1 }
                ],
                3: [
                    { palabra: 'Cama', imagen: 'üõèÔ∏è', silabas: ['Ca', 'ma'], tieneAcento: false },
                    { palabra: 'Paca', imagen: 'üì¶', silabas: ['Pa', 'ca'], tieneAcento: false },
                    { palabra: 'Copa', imagen: 'üèÜ', silabas: ['Co', 'pa'], tieneAcento: false },
                    { palabra: 'Cuna', imagen: 'üë∂', silabas: ['Cu', 'na'], tieneAcento: false }
                ]
            },
            'R': {
                1: [
                    { palabra: 'Rara', imagen: 'ü§™', silabas: ['Ra', 'ra'], tieneAcento: false },
                    { palabra: 'Roro', imagen: 'üöÅ', silabas: ['Ro', 'ro'], tieneAcento: false },
                    { palabra: 'Ruru', imagen: 'üêõ', silabas: ['Ru', 'ru'], tieneAcento: false }
                ],
                2: [
                    { palabra: 'Rar√°', imagen: 'ü¶ú', silabas: ['Ra', 'r√°'], tieneAcento: true, acentoEn: 1 }
                ],
                3: [
                    { palabra: 'Rama', imagen: 'üåø', silabas: ['Ra', 'ma'], tieneAcento: false },
                    { palabra: 'Pera', imagen: 'üçê', silabas: ['Pe', 'ra'], tieneAcento: false },
                    { palabra: 'Ropa', imagen: 'üëï', silabas: ['Ro', 'pa'], tieneAcento: false },
                    { palabra: 'Rosa', imagen: 'üåπ', silabas: ['Ro', 'sa'], tieneAcento: false }
                ]
            },
            'B': {
                1: [
                    { palabra: 'Baba', imagen: 'üíß', silabas: ['Ba', 'ba'], tieneAcento: false },
                    { palabra: 'Bebe', imagen: 'üçº', silabas: ['Be', 'be'], tieneAcento: false },
                    { palabra: 'Bibi', imagen: 'üìñ', silabas: ['Bi', 'bi'], tieneAcento: false },
                    { palabra: 'Bobo', imagen: 'ü§™', silabas: ['Bo', 'bo'], tieneAcento: false },
                    { palabra: 'Bubu', imagen: 'üëª', silabas: ['Bu', 'bu'], tieneAcento: false }
                ],
                2: [
                    { palabra: 'Bab√°', imagen: 'üç∞', silabas: ['Ba', 'b√°'], tieneAcento: true, acentoEn: 1 },
                    { palabra: 'Beb√©', imagen: 'üë∂', silabas: ['Be', 'b√©'], tieneAcento: true, acentoEn: 1 }
                ],
                3: [
                    { palabra: 'Bala', imagen: 'üî´', silabas: ['Ba', 'la'], tieneAcento: false },
                    { palabra: 'Bota', imagen: 'üë¢', silabas: ['Bo', 'ta'], tieneAcento: false },
                    { palabra: 'Boca', imagen: 'üëÑ', silabas: ['Bo', 'ca'], tieneAcento: false },
                    { palabra: 'Cabo', imagen: 'üìç', silabas: ['Ca', 'bo'], tieneAcento: false }
                ]
            }
        };

        // Estado de la aplicaci√≥n
        let letraActual = 'M';
        let nivelActual = 1;
        let letrasDesbloqueadas = ['M'];
        let monedas = 5;
        let stickersDesbloqueados = [false, false, false, false, false];
        let silabasSeleccionadas = [];
        let palabraActualGrabar = 'Mama';
        let palabraActualEscribir = 'Mama';

        // ============================================
        // FUNCIONES DE NORMALIZACI√ìN
        // ============================================
        function normalizarTexto(texto) {
            return texto.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        }

        function compararConTildes(texto1, texto2) {
            if (texto1 === texto2) return true;
            return normalizarTexto(texto1).toLowerCase() === normalizarTexto(texto2).toLowerCase();
        }

        // ============================================
        // VOZ
        // ============================================
        function hablarClaro(texto) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(texto);
                utterance.lang = 'es-ES';
                utterance.rate = 0.45;
                utterance.pitch = 1.2;
                utterance.volume = 1;
                
                const voces = window.speechSynthesis.getVoices();
                const vozEspa√±ola = voces.find(voz => voz.lang === 'es-ES' || voz.lang === 'es-MX');
                if (vozEspa√±ola) utterance.voice = vozEspa√±ola;
                
                window.speechSynthesis.speak(utterance);
            }
        }

        // ============================================
        // SISTEMA DE LETRAS
        // ============================================
        function seleccionarLetra(letra) {
            console.log('Seleccionando letra:', letra);
            
            if (!letrasDesbloqueadas.includes(letra)) {
                if (monedas >= 5) {
                    monedas -= 5;
                    document.getElementById('contadorMonedas').textContent = monedas;
                    letrasDesbloqueadas.push(letra);
                    actualizarSelectorLetras();
                    actualizarMensaje(`¬°Desbloqueaste la letra ${letra}! üéâ`);
                    hablarClaro(`¬°Nueva letra! La letra ${letra}`);
                } else {
                    actualizarMensaje(`Necesitas 5 monedas para desbloquear la ${letra}`);
                    hablarClaro('Sigue practicando para ganar monedas');
                    return;
                }
            }
            
            letraActual = letra;
            actualizarSelectorLetras();
            
            // Actualizar todo
            cargarSilabas();
            cargarPalabras();
            cargarMiniaturasEscritura();
            iniciarJuegoFormar();
            
            actualizarMensaje(`Letra ${letra}: ¬°a practicar!`);
            hablarClaro(`Vamos a aprender la letra ${letra}`);
        }

        function actualizarSelectorLetras() {
            document.querySelectorAll('.letra-boton').forEach(btn => {
                const letra = btn.dataset.letra;
                btn.classList.remove('activa', 'desbloqueada');
                
                if (letra === letraActual) {
                    btn.classList.add('activa');
                }
                
                if (letrasDesbloqueadas.includes(letra)) {
                    btn.classList.add('desbloqueada');
                }
            });
        }

        // ============================================
        // SISTEMA DE NIVELES
        // ============================================
        function cambiarNivel(nivel) {
            nivelActual = nivel;
            
            document.querySelectorAll('.nivel').forEach(n => n.classList.remove('activo'));
            document.querySelector(`[data-nivel="${nivel}"]`).classList.add('activo');
            
            cargarPalabras();
            cargarMiniaturasEscritura();
            iniciarJuegoFormar();
            
            const nombres = ['B√°sico', 'Intermedio', 'Avanzado'];
            actualizarMensaje(`Nivel ${nombres[nivel-1]} - Letra ${letraActual}`);
            hablarClaro(`Nivel ${nombres[nivel-1]}`);
        }

        // ============================================
        // FUNCIONES DE CARGA
        // ============================================
        function cargarSilabas() {
            const silabasContainer = document.getElementById('silabasGrid');
            const silabas = ['ma', 'me', 'mi', 'mo', 'mu'];
            let silabasHtml = '';
            
            silabas.forEach(s => {
                const letraSilaba = s.charAt(0).toUpperCase();
                const desactivada = letraSilaba !== letraActual && !letrasDesbloqueadas.includes(letraSilaba);
                silabasHtml += `<div class="silaba-boton ${desactivada ? 'desactivada' : ''}" onclick="aprenderSilaba('${s}')">${s}</div>`;
            });
            
            silabasContainer.innerHTML = silabasHtml;
        }

        function cargarPalabras() {
            const palabrasContainer = document.getElementById('palabrasJuego');
            const palabras = palabrasPorLetra[letraActual]?.[nivelActual] || palabrasPorLetra['M'][1];
            
            let palabrasHtml = '';
            
            palabras.forEach(p => {
                const claseTexto = p.tieneAcento ? 'texto-palabra-con-acento' : 'texto-palabra';
                
                palabrasHtml += `
                    <div class="palabra-juego" onclick="seleccionarPalabra('${p.palabra}')">
                        <div class="imagen-palabra">${p.imagen}</div>
                        <div>
                            <div class="${claseTexto}">${p.palabra}</div>
                            <div class="silabas-mini">
                                ${p.silabas.map((s, idx) => {
                                    if (p.tieneAcento && idx === p.acentoEn) {
                                        return `<span class="silaba-mini-acento">${s}</span>`;
                                    } else {
                                        return `<span class="silaba-mini">${s}</span>`;
                                    }
                                }).join('')}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            palabrasContainer.innerHTML = palabrasHtml;
        }

        function cargarMiniaturasEscritura() {
            const container = document.getElementById('miniaturasEscritura');
            const palabras = palabrasPorLetra[letraActual]?.[nivelActual] || palabrasPorLetra['M'][1];
            let html = '';
            
            palabras.forEach(p => {
                html += `
                    <div class="miniatura" onclick="cambiarPalabraEscritura('${p.palabra}', '${p.imagen}')">
                        <div class="miniatura-imagen">${p.imagen}</div>
                        <div class="miniatura-texto">${p.palabra}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ============================================
        // FUNCIONES DE REINICIO (NUEVAS)
        // ============================================
        function reiniciarSilabas() {
            cargarSilabas();
            document.getElementById('mensajeSilabas').innerHTML = '¬°Listo para aprender!';
            hablarClaro('Reiniciando s√≠labas');
        }

        function reiniciarPalabras() {
            cargarPalabras();
            actualizarMensaje('Palabras actualizadas');
        }

        function reiniciarJuegoFormar() {
            iniciarJuegoFormar();
            hablarClaro('Nueva palabra');
        }

        function limpiarZonaFormar() {
            document.getElementById('zonaSoltar').innerHTML = 'üëÜ Toca las s√≠labas';
            silabasSeleccionadas = [];
            document.getElementById('resultadoFormar').innerHTML = '';
        }

        function reiniciarEscritura() {
            cargarMiniaturasEscritura();
            cambiarPalabraEscrituraAleatoria();
            limpiarInputEscritura();
        }

        function limpiarInputEscritura() {
            document.getElementById('inputEscritura').value = '';
            document.getElementById('resultadoEscritura').innerHTML = '';
        }

        // ============================================
        // RECOMPENSAS
        // ============================================
        function ganarMoneda(cantidad = 1) {
            monedas += cantidad;
            document.getElementById('contadorMonedas').textContent = monedas;
            
            if (monedas >= 3 && !stickersDesbloqueados[0]) desbloquearSticker(0);
            if (monedas >= 6 && !stickersDesbloqueados[1]) desbloquearSticker(1);
            if (monedas >= 10 && !stickersDesbloqueados[2]) desbloquearSticker(2);
            if (monedas >= 15 && !stickersDesbloqueados[3]) desbloquearSticker(3);
            if (monedas >= 20 && !stickersDesbloqueados[4]) desbloquearSticker(4);
            
            actualizarMensaje('¬°Ganaste ' + cantidad + ' moneda! ü™ô');
        }

        function desbloquearSticker(indice) {
            stickersDesbloqueados[indice] = true;
            const stickers = document.querySelectorAll('.sticker');
            stickers[indice].classList.add('desbloqueado');
            actualizarMensaje('¬°Desbloqueaste un sticker! ' + stickers[indice].textContent);
            hablarClaro('¬°Muy bien! Ganaste un sticker');
        }

        function actualizarMensaje(mensaje) {
            document.getElementById('mensajePersonaje').textContent = mensaje;
        }

        // ============================================
        // APRENDER
        // ============================================
        function aprenderSilaba(silaba) {
            const letraSilaba = silaba.charAt(0).toUpperCase();
            if (letraSilaba !== letraActual && !letrasDesbloqueadas.includes(letraSilaba)) {
                actualizarMensaje(`Primero desbloquea la letra ${letraSilaba}`);
                return;
            }
            
            hablarClaro(silaba);
            document.getElementById('mensajeSilabas').innerHTML = `üîä ${silaba}`;
            if (Math.random() < 0.3) ganarMoneda(1);
        }

        function seleccionarPalabra(palabra) {
            palabraActualGrabar = palabra;
            hablarClaro(palabra);
            actualizarMensaje(`Palabra: ${palabra}`);
            document.getElementById('mensajeSilabas').innerHTML = `üîä ${palabra}`;
        }

        // ============================================
        // JUEGO DE FORMAR
        // ============================================
        function iniciarJuegoFormar() {
            const palabras = palabrasPorLetra[letraActual]?.[nivelActual] || palabrasPorLetra['M'][1];
            const palabraRandom = palabras[Math.floor(Math.random() * palabras.length)];
            
            document.getElementById('palabraObjetivo').textContent = palabraRandom.palabra;
            
            let silabasJuego = [];
            palabraRandom.silabas.forEach(s => silabasJuego.push(s));
            
            const silabasExtras = ['ma', 'me', 'mi', 'mo', 'mu', 'pa', 'pe', 'la', 'sa', 'ta'];
            while (silabasJuego.length < 4) {
                const extra = silabasExtras[Math.floor(Math.random() * silabasExtras.length)];
                if (!silabasJuego.includes(extra)) silabasJuego.push(extra);
            }
            
            silabasJuego.sort(() => Math.random() - 0.5);
            
            let html = '';
            silabasJuego.forEach(silaba => {
                const tieneAcento = /[√Å√â√ç√ì√ö√°√©√≠√≥√∫]/.test(silaba);
                html += `<div class="silaba-arrastrable ${tieneAcento ? 'acento' : ''}" onclick="seleccionarSilabaTactil('${silaba}')">${silaba}</div>`;
            });
            
            document.getElementById('silabasArrastrables').innerHTML = html;
            document.getElementById('zonaSoltar').innerHTML = 'üëÜ Toca las s√≠labas';
            silabasSeleccionadas = [];
            document.getElementById('resultadoFormar').innerHTML = '';
        }

        function seleccionarSilabaTactil(silaba) {
            const palabraObjetivo = document.getElementById('palabraObjetivo').textContent;
            const palabras = palabrasPorLetra[letraActual]?.[nivelActual] || palabrasPorLetra['M'][1];
            const palabraData = palabras.find(p => p.palabra === palabraObjetivo);
            const numSilabas = palabraData ? palabraData.silabas.length : 2;
            
            if (silabasSeleccionadas.length < numSilabas) {
                silabasSeleccionadas.push(silaba);
                const zona = document.getElementById('zonaSoltar');
                
                if (zona.innerHTML === 'üëÜ Toca las s√≠labas') zona.innerHTML = '';
                
                const tieneAcento = /[√Å√â√ç√ì√ö√°√©√≠√≥√∫]/.test(silaba);
                const color = tieneAcento ? '#FFB347' : '#2C8F8F';
                
                zona.innerHTML += `<span style="background: ${color}; color: white; padding: 12px 20px; border-radius: 30px; font-size: 1.6em; margin: 0 5px; border: 3px solid white;">${silaba}</span>`;
            }
        }

        function agregarAcento(vocalAcentuada) {
            if (silabasSeleccionadas.length > 0) {
                let ultimaSilaba = silabasSeleccionadas[silabasSeleccionadas.length - 1];
                const vocales = ['a', 'e', 'i', 'o', 'u', 'A', 'E', 'I', 'O', 'U'];
                
                for (let i = ultimaSilaba.length - 1; i >= 0; i--) {
                    if (vocales.includes(ultimaSilaba[i])) {
                        ultimaSilaba = ultimaSilaba.substring(0, i) + vocalAcentuada + ultimaSilaba.substring(i + 1);
                        silabasSeleccionadas[silabasSeleccionadas.length - 1] = ultimaSilaba;
                        break;
                    }
                }
                
                actualizarZonaSoltar();
            }
        }

        function actualizarZonaSoltar() {
            const zona = document.getElementById('zonaSoltar');
            zona.innerHTML = '';
            
            silabasSeleccionadas.forEach(silaba => {
                const tieneAcento = /[√Å√â√ç√ì√ö√°√©√≠√≥√∫]/.test(silaba);
                const color = tieneAcento ? '#FFB347' : '#2C8F8F';
                zona.innerHTML += `<span style="background: ${color}; color: white; padding: 12px 20px; border-radius: 30px; font-size: 1.6em; margin: 0 5px; border: 3px solid white;">${silaba}</span>`;
            });
        }

        function verificarPalabraFormada() {
            const palabraObjetivo = document.getElementById('palabraObjetivo').textContent;
            const palabraFormada = silabasSeleccionadas.join('');
            
            const palabras = palabrasPorLetra[letraActual]?.[nivelActual] || palabrasPorLetra['M'][1];
            const palabraData = palabras.find(p => compararConTildes(p.palabra, palabraFormada));
            
            if (palabraFormada === palabraObjetivo) {
                document.getElementById('resultadoFormar').innerHTML = '<div class="mensaje-exito">üéâ ¬°Excelente! +2 monedas</div>';
                hablarClaro('¬°Muy bien! ' + palabraFormada);
                ganarMoneda(2);
                setTimeout(iniciarJuegoFormar, 1500);
            } else if (palabraData && compararConTildes(palabraData.palabra, palabraFormada)) {
                document.getElementById('resultadoFormar').innerHTML = '<div class="mensaje-juego">üëç ¬°Bien! Pero falta la tilde en ' + palabraObjetivo + '</div>';
                hablarClaro('Casi, recuerda la tilde');
            } else {
                document.getElementById('resultadoFormar').innerHTML = '<div class="mensaje-juego">ü§î Intenta otra vez</div>';
                hablarClaro('Casi, intenta de nuevo');
            }
        }

        // ============================================
        // ESCRITURA
        // ============================================
        function agregarAcentoEscritura(vocalAcentuada) {
            const input = document.getElementById('inputEscritura');
            const posicion = input.selectionStart;
            const valorActual = input.value;
            
            const nuevoValor = valorActual.substring(0, posicion) + vocalAcentuada + valorActual.substring(posicion);
            input.value = nuevoValor;
            
            input.setSelectionRange(posicion + 1, posicion + 1);
            input.focus();
        }

        function cambiarPalabraEscritura(palabra, imagen) {
            palabraActualEscribir = palabra;
            document.getElementById('imagenEscritura').textContent = imagen;
            document.getElementById('inputEscritura').value = '';
            document.getElementById('resultadoEscritura').innerHTML = '';
            hablarClaro(palabra);
        }

        function cambiarPalabraEscrituraAleatoria() {
            const palabras = palabrasPorLetra[letraActual]?.[nivelActual] || palabrasPorLetra['M'][1];
            const randomIndex = Math.floor(Math.random() * palabras.length);
            const p = palabras[randomIndex];
            cambiarPalabraEscritura(p.palabra, p.imagen);
        }

        function verificarEscritura() {
            const escrito = document.getElementById('inputEscritura').value.trim();
            
            if (escrito === palabraActualEscribir) {
                document.getElementById('resultadoEscritura').innerHTML = '<div class="mensaje-exito">‚≠ê ¬°Perfecto! +3 monedas ‚≠ê</div>';
                hablarClaro('¬°Excelente! Escribiste ' + palabraActualEscribir);
                ganarMoneda(3);
            } else if (normalizarTexto(escrito).toLowerCase() === normalizarTexto(palabraActualEscribir).toLowerCase()) {
                document.getElementById('resultadoEscritura').innerHTML = '<div class="mensaje-juego">üëç ¬°Bien! Pero revisa may√∫sculas o tildes: ' + palabraActualEscribir + '</div>';
                hablarClaro('Casi, revisa las may√∫sculas y tildes');
            } else {
                document.getElementById('resultadoEscritura').innerHTML = '<div class="mensaje-juego">‚úèÔ∏è La palabra es ' + palabraActualEscribir + '</div>';
                hablarClaro('La palabra es ' + palabraActualEscribir);
            }
        }

        // ============================================
        // INICIALIZAR
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Aplicaci√≥n iniciada');
            
            document.getElementById('contadorMonedas').textContent = monedas;
            
            cargarSilabas();
            cargarPalabras();
            cargarMiniaturasEscritura();
            iniciarJuegoFormar();
            
            setTimeout(() => {
                hablarClaro('¬°Hola! Elige una letra para aprender');
                actualizarMensaje('¬°Hola! Soy M, tu profesor üêµ');
            }, 500);
            
            document.querySelectorAll('button, .silaba-boton, .palabra-juego, .silaba-arrastrable, .miniatura, .letra-boton').forEach(el => {
                el.addEventListener('touchstart', (e) => e.preventDefault());
            });
        });
    </script>
</body>
</html>